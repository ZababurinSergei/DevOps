<!DOCTYPE html>
<html lang="ru">
<head></head>
<body></body>
<script type="module">
    navigator.serviceWorker.register('./sw.mjs', {
        type: 'module',
        scope: '/DevOps/sw/'
    }).then((registration) => {
        console.log('Service worker registered successfully', registration);
        if (!navigator.serviceWorker.controller) {
            navigator.serviceWorker.addEventListener('message', (event) => {
                if (event?.data?.type === 'SW_ACTIVATED') {
                    window.location.reload();
                }
            });
        }
    }).catch((err) => {
        console.log('Service worker registration failed: ', err);
    });
    window.addEventListener('message', (event) => {
        if(event.data.hasOwnProperty('html')) {
            let htmlHead = event.data.html.slice(event.data.html.indexOf('<head>'), event.data.html.indexOf('</head>'))
            let htmlBody = event.data.html.slice(event.data.html.indexOf('<body>'), event.data.html.indexOf('</body>'))

            const divFragmentHead = document.createRange().createContextualFragment(`${htmlHead}`);
            const divFragmentBody = document.createRange().createContextualFragment(`${htmlBody}`);

            document.head.appendChild(divFragmentHead);
            document.body.appendChild(divFragmentBody);
        }

        console.log('MESSAGE', event.data)
    }, false)
</script>
</html>
